
import cv2
import numpy as np
import os,re
import matplotlib.pyplot as plt
import scipy.ndimage.filters as spfilt



# WSize = 30
# N = int(np.floor(WSize/ 2))
# sig = N / 2.5
# [x, y] = np.meshgrid(range(-N,N+1),range(-N,N+1))
# G = np.exp(-(x**2 + y**2) / (2 * sig**2)) / (2 * np.pi * sig)
# Gx = -x*G / (sig**2)
# Gx = Gx / np.sum(np.abs(Gx))
# Gy = -y*G / (sig**2)
# Gy = Gy / np.sum(np.abs(Gy))

Gx = np.array([[  2.80589087e-05,   3.91770490e-05,   5.29306792e-05,
          6.91420188e-05,   8.72341341e-05,   1.06160509e-04,
          1.24397310e-04,   1.40023272e-04,   1.50898975e-04,
          1.54936515e-04,   1.50426061e-04,   1.36364046e-04,
          1.12715650e-04,   8.05475431e-05,   4.19872959e-05,
          0.00000000e+00,  -4.19872959e-05,  -8.05475431e-05,
         -1.12715650e-04,  -1.36364046e-04,  -1.50426061e-04,
         -1.54936515e-04,  -1.50898975e-04,  -1.40023272e-04,
         -1.24397310e-04,  -1.06160509e-04,  -8.72341341e-05,
         -6.91420188e-05,  -5.29306792e-05,  -3.91770490e-05,
         -2.80589087e-05],
       [  4.19754096e-05,   5.86078630e-05,   7.91829419e-05,
          1.03434691e-04,   1.30500033e-04,   1.58813406e-04,
          1.86095194e-04,   2.09471232e-04,   2.25741007e-04,
          2.31781062e-04,   2.25033538e-04,   2.03997125e-04,
          1.68619728e-04,   1.20497064e-04,   6.28119205e-05,
          0.00000000e+00,  -6.28119205e-05,  -1.20497064e-04,
         -1.68619728e-04,  -2.03997125e-04,  -2.25033538e-04,
         -2.31781062e-04,  -2.25741007e-04,  -2.09471232e-04,
         -1.86095194e-04,  -1.58813406e-04,  -1.30500033e-04,
         -1.03434691e-04,  -7.91829419e-05,  -5.86078630e-05,
         -4.19754096e-05],
       [  6.10738606e-05,   8.52739375e-05,   1.15210501e-04,
          1.50496588e-04,   1.89876427e-04,   2.31072142e-04,
          2.70766909e-04,   3.04778844e-04,   3.28451227e-04,
          3.37239456e-04,   3.27421866e-04,   2.96814065e-04,
          2.45340257e-04,   1.75322193e-04,   9.13908050e-05,
          0.00000000e+00,  -9.13908050e-05,  -1.75322193e-04,
         -2.45340257e-04,  -2.96814065e-04,  -3.27421866e-04,
         -3.37239456e-04,  -3.28451227e-04,  -3.04778844e-04,
         -2.70766909e-04,  -2.31072142e-04,  -1.89876427e-04,
         -1.50496588e-04,  -1.15210501e-04,  -8.52739375e-05,
         -6.10738606e-05],
       [  8.64275235e-05,   1.20673806e-04,   1.63037970e-04,
          2.12972411e-04,   2.68700050e-04,   3.26997389e-04,
          3.83170692e-04,   4.31302041e-04,   4.64801567e-04,
          4.77238064e-04,   4.63344887e-04,   4.20030834e-04,
          3.47188643e-04,   2.48103899e-04,   1.29329976e-04,
          0.00000000e+00,  -1.29329976e-04,  -2.48103899e-04,
         -3.47188643e-04,  -4.20030834e-04,  -4.63344887e-04,
         -4.77238064e-04,  -4.64801567e-04,  -4.31302041e-04,
         -3.83170692e-04,  -3.26997389e-04,  -2.68700050e-04,
         -2.12972411e-04,  -1.63037970e-04,  -1.20673806e-04,
         -8.64275235e-05],
       [  1.18955637e-04,   1.66090951e-04,   2.24399414e-04,
          2.93127327e-04,   3.69828781e-04,   4.50067077e-04,
          5.27381927e-04,   5.93628130e-04,   6.39735635e-04,
          6.56852768e-04,   6.37730715e-04,   5.78114859e-04,
          4.77857569e-04,   3.41481004e-04,   1.78004982e-04,
          0.00000000e+00,  -1.78004982e-04,  -3.41481004e-04,
         -4.77857569e-04,  -5.78114859e-04,  -6.37730715e-04,
         -6.56852768e-04,  -6.39735635e-04,  -5.93628130e-04,
         -5.27381927e-04,  -4.50067077e-04,  -3.69828781e-04,
         -2.93127327e-04,  -2.24399414e-04,  -1.66090951e-04,
         -1.18955637e-04],
       [  1.59240764e-04,   2.22338768e-04,   3.00393785e-04,
          3.92396867e-04,   4.95073785e-04,   6.02485319e-04,
          7.05983362e-04,   7.94664288e-04,   8.56386410e-04,
          8.79300375e-04,   8.53702510e-04,   7.73897343e-04,
          6.39687248e-04,   4.57125842e-04,   2.38287566e-04,
          0.00000000e+00,  -2.38287566e-04,  -4.57125842e-04,
         -6.39687248e-04,  -7.73897343e-04,  -8.53702510e-04,
         -8.79300375e-04,  -8.56386410e-04,  -7.94664288e-04,
         -7.05983362e-04,  -6.02485319e-04,  -4.95073785e-04,
         -3.92396867e-04,  -3.00393785e-04,  -2.22338768e-04,
         -1.59240764e-04],
       [  2.07328851e-04,   2.89481413e-04,   3.91107758e-04,
          5.10894256e-04,   6.44577910e-04,   7.84425958e-04,
          9.19178706e-04,   1.03463981e-03,   1.11500100e-03,
          1.14483460e-03,   1.11150660e-03,   1.00760159e-03,
          8.32862258e-04,   5.95170315e-04,   3.10246485e-04,
          0.00000000e+00,  -3.10246485e-04,  -5.95170315e-04,
         -8.32862258e-04,  -1.00760159e-03,  -1.11150660e-03,
         -1.14483460e-03,  -1.11500100e-03,  -1.03463981e-03,
         -9.19178706e-04,  -7.84425958e-04,  -6.44577910e-04,
         -5.10894256e-04,  -3.91107758e-04,  -2.89481413e-04,
         -2.07328851e-04],
       [  2.62543635e-04,   3.66574656e-04,   4.95265622e-04,
          6.46953061e-04,   8.16238679e-04,   9.93330361e-04,
          1.16396979e-03,   1.31017992e-03,   1.41194249e-03,
          1.44972123e-03,   1.40751749e-03,   1.27594101e-03,
          1.05466597e-03,   7.53673100e-04,   3.92869779e-04,
          0.00000000e+00,  -3.92869779e-04,  -7.53673100e-04,
         -1.05466597e-03,  -1.27594101e-03,  -1.40751749e-03,
         -1.44972123e-03,  -1.41194249e-03,  -1.31017992e-03,
         -1.16396979e-03,  -9.93330361e-04,  -8.16238679e-04,
         -6.46953061e-04,  -4.95265622e-04,  -3.66574656e-04,
         -2.62543635e-04],
       [  3.23354947e-04,   4.51482013e-04,   6.09980850e-04,
          7.96802686e-04,   1.00529886e-03,   1.22340916e-03,
          1.43357271e-03,   1.61364856e-03,   1.73898175e-03,
          1.78551094e-03,   1.73353181e-03,   1.57147911e-03,
          1.29895155e-03,   9.28241608e-04,   4.83867708e-04,
          0.00000000e+00,  -4.83867708e-04,  -9.28241608e-04,
         -1.29895155e-03,  -1.57147911e-03,  -1.73353181e-03,
         -1.78551094e-03,  -1.73898175e-03,  -1.61364856e-03,
         -1.43357271e-03,  -1.22340916e-03,  -1.00529886e-03,
         -7.96802686e-04,  -6.09980850e-04,  -4.51482013e-04,
         -3.23354947e-04],
       [  3.87341287e-04,   5.40822479e-04,   7.30685488e-04,
          9.54476128e-04,   1.20423008e-03,   1.46550063e-03,
          1.71725190e-03,   1.93296164e-03,   2.08309610e-03,
          2.13883261e-03,   2.07656772e-03,   1.88244760e-03,
          1.55599155e-03,   1.11192453e-03,   5.79616741e-04,
          0.00000000e+00,  -5.79616741e-04,  -1.11192453e-03,
         -1.55599155e-03,  -1.88244760e-03,  -2.07656772e-03,
         -2.13883261e-03,  -2.08309610e-03,  -1.93296164e-03,
         -1.71725190e-03,  -1.46550063e-03,  -1.20423008e-03,
         -9.54476128e-04,  -7.30685488e-04,  -5.40822479e-04,
         -3.87341287e-04],
       [  4.51278182e-04,   6.30093908e-04,   8.51296853e-04,
          1.11202773e-03,   1.40300757e-03,   1.70740502e-03,
          2.00071188e-03,   2.25202798e-03,   2.42694454e-03,
          2.49188126e-03,   2.41933854e-03,   2.19317578e-03,
          1.81283292e-03,   1.29546552e-03,   6.75291785e-04,
          0.00000000e+00,  -6.75291785e-04,  -1.29546552e-03,
         -1.81283292e-03,  -2.19317578e-03,  -2.41933854e-03,
         -2.49188126e-03,  -2.42694454e-03,  -2.25202798e-03,
         -2.00071188e-03,  -1.70740502e-03,  -1.40300757e-03,
         -1.11202773e-03,  -8.51296853e-04,  -6.30093908e-04,
         -4.51278182e-04],
       [  5.11365174e-04,   7.13989937e-04,   9.64645712e-04,
          1.26009250e-03,   1.58981586e-03,   1.93474336e-03,
          2.26710358e-03,   2.55188202e-03,   2.75008845e-03,
          2.82367139e-03,   2.74146972e-03,   2.48519374e-03,
          2.05420882e-03,   1.46795475e-03,   7.65205842e-04,
          0.00000000e+00,  -7.65205842e-04,  -1.46795475e-03,
         -2.05420882e-03,  -2.48519374e-03,  -2.74146972e-03,
         -2.82367139e-03,  -2.75008845e-03,  -2.55188202e-03,
         -2.26710358e-03,  -1.93474336e-03,  -1.58981586e-03,
         -1.26009250e-03,  -9.64645712e-04,  -7.13989937e-04,
         -5.11365174e-04],
       [  5.63578248e-04,   7.86892064e-04,   1.06314111e-03,
          1.38875457e-03,   1.75214442e-03,   2.13229083e-03,
          2.49858677e-03,   2.81244260e-03,   3.03088694e-03,
          3.11198309e-03,   3.02138820e-03,   2.73894509e-03,
          2.26395434e-03,   1.61784065e-03,   8.43337382e-04,
          0.00000000e+00,  -8.43337382e-04,  -1.61784065e-03,
         -2.26395434e-03,  -2.73894509e-03,  -3.02138820e-03,
         -3.11198309e-03,  -3.03088694e-03,  -2.81244260e-03,
         -2.49858677e-03,  -2.13229083e-03,  -1.75214442e-03,
         -1.38875457e-03,  -1.06314111e-03,  -7.86892064e-04,
         -5.63578248e-04],
       [  6.04106573e-04,   8.43479446e-04,   1.13959426e-03,
          1.48862340e-03,   1.87814552e-03,   2.28562921e-03,
          2.67826642e-03,   3.01469240e-03,   3.24884563e-03,
          3.33577360e-03,   3.23866380e-03,   2.93590950e-03,
          2.42676098e-03,   1.73418363e-03,   9.03983889e-04,
          0.00000000e+00,  -9.03983889e-04,  -1.73418363e-03,
         -2.42676098e-03,  -2.93590950e-03,  -3.23866380e-03,
         -3.33577360e-03,  -3.24884563e-03,  -3.01469240e-03,
         -2.67826642e-03,  -2.28562921e-03,  -1.87814552e-03,
         -1.48862340e-03,  -1.13959426e-03,  -8.43479446e-04,
         -6.04106573e-04],
       [  6.29809439e-04,   8.79366886e-04,   1.18808047e-03,
          1.55195972e-03,   1.95805480e-03,   2.38287566e-03,
          2.79221836e-03,   3.14295823e-03,   3.38707395e-03,
          3.47770045e-03,   3.37645893e-03,   3.06082337e-03,
          2.53001215e-03,   1.80796778e-03,   9.42445606e-04,
          0.00000000e+00,  -9.42445606e-04,  -1.80796778e-03,
         -2.53001215e-03,  -3.06082337e-03,  -3.37645893e-03,
         -3.47770045e-03,  -3.38707395e-03,  -3.14295823e-03,
         -2.79221836e-03,  -2.38287566e-03,  -1.95805480e-03,
         -1.55195972e-03,  -1.18808047e-03,  -8.79366886e-04,
         -6.29809439e-04],
       [  6.38617820e-04,   8.91665525e-04,   1.20469671e-03,
          1.57366509e-03,   1.98543974e-03,   2.41620205e-03,
          2.83126974e-03,   3.18691498e-03,   3.43444485e-03,
          3.52633883e-03,   3.42368136e-03,   3.10363139e-03,
          2.56539636e-03,   1.83325363e-03,   9.55626450e-04,
          0.00000000e+00,  -9.55626450e-04,  -1.83325363e-03,
         -2.56539636e-03,  -3.10363139e-03,  -3.42368136e-03,
         -3.52633883e-03,  -3.43444485e-03,  -3.18691498e-03,
         -2.83126974e-03,  -2.41620205e-03,  -1.98543974e-03,
         -1.57366509e-03,  -1.20469671e-03,  -8.91665525e-04,
         -6.38617820e-04],
       [  6.29809439e-04,   8.79366886e-04,   1.18808047e-03,
          1.55195972e-03,   1.95805480e-03,   2.38287566e-03,
          2.79221836e-03,   3.14295823e-03,   3.38707395e-03,
          3.47770045e-03,   3.37645893e-03,   3.06082337e-03,
          2.53001215e-03,   1.80796778e-03,   9.42445606e-04,
          0.00000000e+00,  -9.42445606e-04,  -1.80796778e-03,
         -2.53001215e-03,  -3.06082337e-03,  -3.37645893e-03,
         -3.47770045e-03,  -3.38707395e-03,  -3.14295823e-03,
         -2.79221836e-03,  -2.38287566e-03,  -1.95805480e-03,
         -1.55195972e-03,  -1.18808047e-03,  -8.79366886e-04,
         -6.29809439e-04],
       [  6.04106573e-04,   8.43479446e-04,   1.13959426e-03,
          1.48862340e-03,   1.87814552e-03,   2.28562921e-03,
          2.67826642e-03,   3.01469240e-03,   3.24884563e-03,
          3.33577360e-03,   3.23866380e-03,   2.93590950e-03,
          2.42676098e-03,   1.73418363e-03,   9.03983889e-04,
          0.00000000e+00,  -9.03983889e-04,  -1.73418363e-03,
         -2.42676098e-03,  -2.93590950e-03,  -3.23866380e-03,
         -3.33577360e-03,  -3.24884563e-03,  -3.01469240e-03,
         -2.67826642e-03,  -2.28562921e-03,  -1.87814552e-03,
         -1.48862340e-03,  -1.13959426e-03,  -8.43479446e-04,
         -6.04106573e-04],
       [  5.63578248e-04,   7.86892064e-04,   1.06314111e-03,
          1.38875457e-03,   1.75214442e-03,   2.13229083e-03,
          2.49858677e-03,   2.81244260e-03,   3.03088694e-03,
          3.11198309e-03,   3.02138820e-03,   2.73894509e-03,
          2.26395434e-03,   1.61784065e-03,   8.43337382e-04,
          0.00000000e+00,  -8.43337382e-04,  -1.61784065e-03,
         -2.26395434e-03,  -2.73894509e-03,  -3.02138820e-03,
         -3.11198309e-03,  -3.03088694e-03,  -2.81244260e-03,
         -2.49858677e-03,  -2.13229083e-03,  -1.75214442e-03,
         -1.38875457e-03,  -1.06314111e-03,  -7.86892064e-04,
         -5.63578248e-04],
       [  5.11365174e-04,   7.13989937e-04,   9.64645712e-04,
          1.26009250e-03,   1.58981586e-03,   1.93474336e-03,
          2.26710358e-03,   2.55188202e-03,   2.75008845e-03,
          2.82367139e-03,   2.74146972e-03,   2.48519374e-03,
          2.05420882e-03,   1.46795475e-03,   7.65205842e-04,
          0.00000000e+00,  -7.65205842e-04,  -1.46795475e-03,
         -2.05420882e-03,  -2.48519374e-03,  -2.74146972e-03,
         -2.82367139e-03,  -2.75008845e-03,  -2.55188202e-03,
         -2.26710358e-03,  -1.93474336e-03,  -1.58981586e-03,
         -1.26009250e-03,  -9.64645712e-04,  -7.13989937e-04,
         -5.11365174e-04],
       [  4.51278182e-04,   6.30093908e-04,   8.51296853e-04,
          1.11202773e-03,   1.40300757e-03,   1.70740502e-03,
          2.00071188e-03,   2.25202798e-03,   2.42694454e-03,
          2.49188126e-03,   2.41933854e-03,   2.19317578e-03,
          1.81283292e-03,   1.29546552e-03,   6.75291785e-04,
          0.00000000e+00,  -6.75291785e-04,  -1.29546552e-03,
         -1.81283292e-03,  -2.19317578e-03,  -2.41933854e-03,
         -2.49188126e-03,  -2.42694454e-03,  -2.25202798e-03,
         -2.00071188e-03,  -1.70740502e-03,  -1.40300757e-03,
         -1.11202773e-03,  -8.51296853e-04,  -6.30093908e-04,
         -4.51278182e-04],
       [  3.87341287e-04,   5.40822479e-04,   7.30685488e-04,
          9.54476128e-04,   1.20423008e-03,   1.46550063e-03,
          1.71725190e-03,   1.93296164e-03,   2.08309610e-03,
          2.13883261e-03,   2.07656772e-03,   1.88244760e-03,
          1.55599155e-03,   1.11192453e-03,   5.79616741e-04,
          0.00000000e+00,  -5.79616741e-04,  -1.11192453e-03,
         -1.55599155e-03,  -1.88244760e-03,  -2.07656772e-03,
         -2.13883261e-03,  -2.08309610e-03,  -1.93296164e-03,
         -1.71725190e-03,  -1.46550063e-03,  -1.20423008e-03,
         -9.54476128e-04,  -7.30685488e-04,  -5.40822479e-04,
         -3.87341287e-04],
       [  3.23354947e-04,   4.51482013e-04,   6.09980850e-04,
          7.96802686e-04,   1.00529886e-03,   1.22340916e-03,
          1.43357271e-03,   1.61364856e-03,   1.73898175e-03,
          1.78551094e-03,   1.73353181e-03,   1.57147911e-03,
          1.29895155e-03,   9.28241608e-04,   4.83867708e-04,
          0.00000000e+00,  -4.83867708e-04,  -9.28241608e-04,
         -1.29895155e-03,  -1.57147911e-03,  -1.73353181e-03,
         -1.78551094e-03,  -1.73898175e-03,  -1.61364856e-03,
         -1.43357271e-03,  -1.22340916e-03,  -1.00529886e-03,
         -7.96802686e-04,  -6.09980850e-04,  -4.51482013e-04,
         -3.23354947e-04],
       [  2.62543635e-04,   3.66574656e-04,   4.95265622e-04,
          6.46953061e-04,   8.16238679e-04,   9.93330361e-04,
          1.16396979e-03,   1.31017992e-03,   1.41194249e-03,
          1.44972123e-03,   1.40751749e-03,   1.27594101e-03,
          1.05466597e-03,   7.53673100e-04,   3.92869779e-04,
          0.00000000e+00,  -3.92869779e-04,  -7.53673100e-04,
         -1.05466597e-03,  -1.27594101e-03,  -1.40751749e-03,
         -1.44972123e-03,  -1.41194249e-03,  -1.31017992e-03,
         -1.16396979e-03,  -9.93330361e-04,  -8.16238679e-04,
         -6.46953061e-04,  -4.95265622e-04,  -3.66574656e-04,
         -2.62543635e-04],
       [  2.07328851e-04,   2.89481413e-04,   3.91107758e-04,
          5.10894256e-04,   6.44577910e-04,   7.84425958e-04,
          9.19178706e-04,   1.03463981e-03,   1.11500100e-03,
          1.14483460e-03,   1.11150660e-03,   1.00760159e-03,
          8.32862258e-04,   5.95170315e-04,   3.10246485e-04,
          0.00000000e+00,  -3.10246485e-04,  -5.95170315e-04,
         -8.32862258e-04,  -1.00760159e-03,  -1.11150660e-03,
         -1.14483460e-03,  -1.11500100e-03,  -1.03463981e-03,
         -9.19178706e-04,  -7.84425958e-04,  -6.44577910e-04,
         -5.10894256e-04,  -3.91107758e-04,  -2.89481413e-04,
         -2.07328851e-04],
       [  1.59240764e-04,   2.22338768e-04,   3.00393785e-04,
          3.92396867e-04,   4.95073785e-04,   6.02485319e-04,
          7.05983362e-04,   7.94664288e-04,   8.56386410e-04,
          8.79300375e-04,   8.53702510e-04,   7.73897343e-04,
          6.39687248e-04,   4.57125842e-04,   2.38287566e-04,
          0.00000000e+00,  -2.38287566e-04,  -4.57125842e-04,
         -6.39687248e-04,  -7.73897343e-04,  -8.53702510e-04,
         -8.79300375e-04,  -8.56386410e-04,  -7.94664288e-04,
         -7.05983362e-04,  -6.02485319e-04,  -4.95073785e-04,
         -3.92396867e-04,  -3.00393785e-04,  -2.22338768e-04,
         -1.59240764e-04],
       [  1.18955637e-04,   1.66090951e-04,   2.24399414e-04,
          2.93127327e-04,   3.69828781e-04,   4.50067077e-04,
          5.27381927e-04,   5.93628130e-04,   6.39735635e-04,
          6.56852768e-04,   6.37730715e-04,   5.78114859e-04,
          4.77857569e-04,   3.41481004e-04,   1.78004982e-04,
          0.00000000e+00,  -1.78004982e-04,  -3.41481004e-04,
         -4.77857569e-04,  -5.78114859e-04,  -6.37730715e-04,
         -6.56852768e-04,  -6.39735635e-04,  -5.93628130e-04,
         -5.27381927e-04,  -4.50067077e-04,  -3.69828781e-04,
         -2.93127327e-04,  -2.24399414e-04,  -1.66090951e-04,
         -1.18955637e-04],
       [  8.64275235e-05,   1.20673806e-04,   1.63037970e-04,
          2.12972411e-04,   2.68700050e-04,   3.26997389e-04,
          3.83170692e-04,   4.31302041e-04,   4.64801567e-04,
          4.77238064e-04,   4.63344887e-04,   4.20030834e-04,
          3.47188643e-04,   2.48103899e-04,   1.29329976e-04,
          0.00000000e+00,  -1.29329976e-04,  -2.48103899e-04,
         -3.47188643e-04,  -4.20030834e-04,  -4.63344887e-04,
         -4.77238064e-04,  -4.64801567e-04,  -4.31302041e-04,
         -3.83170692e-04,  -3.26997389e-04,  -2.68700050e-04,
         -2.12972411e-04,  -1.63037970e-04,  -1.20673806e-04,
         -8.64275235e-05],
       [  6.10738606e-05,   8.52739375e-05,   1.15210501e-04,
          1.50496588e-04,   1.89876427e-04,   2.31072142e-04,
          2.70766909e-04,   3.04778844e-04,   3.28451227e-04,
          3.37239456e-04,   3.27421866e-04,   2.96814065e-04,
          2.45340257e-04,   1.75322193e-04,   9.13908050e-05,
          0.00000000e+00,  -9.13908050e-05,  -1.75322193e-04,
         -2.45340257e-04,  -2.96814065e-04,  -3.27421866e-04,
         -3.37239456e-04,  -3.28451227e-04,  -3.04778844e-04,
         -2.70766909e-04,  -2.31072142e-04,  -1.89876427e-04,
         -1.50496588e-04,  -1.15210501e-04,  -8.52739375e-05,
         -6.10738606e-05],
       [  4.19754096e-05,   5.86078630e-05,   7.91829419e-05,
          1.03434691e-04,   1.30500033e-04,   1.58813406e-04,
          1.86095194e-04,   2.09471232e-04,   2.25741007e-04,
          2.31781062e-04,   2.25033538e-04,   2.03997125e-04,
          1.68619728e-04,   1.20497064e-04,   6.28119205e-05,
          0.00000000e+00,  -6.28119205e-05,  -1.20497064e-04,
         -1.68619728e-04,  -2.03997125e-04,  -2.25033538e-04,
         -2.31781062e-04,  -2.25741007e-04,  -2.09471232e-04,
         -1.86095194e-04,  -1.58813406e-04,  -1.30500033e-04,
         -1.03434691e-04,  -7.91829419e-05,  -5.86078630e-05,
         -4.19754096e-05],
       [  2.80589087e-05,   3.91770490e-05,   5.29306792e-05,
          6.91420188e-05,   8.72341341e-05,   1.06160509e-04,
          1.24397310e-04,   1.40023272e-04,   1.50898975e-04,
          1.54936515e-04,   1.50426061e-04,   1.36364046e-04,
          1.12715650e-04,   8.05475431e-05,   4.19872959e-05,
          0.00000000e+00,  -4.19872959e-05,  -8.05475431e-05,
         -1.12715650e-04,  -1.36364046e-04,  -1.50426061e-04,
         -1.54936515e-04,  -1.50898975e-04,  -1.40023272e-04,
         -1.24397310e-04,  -1.06160509e-04,  -8.72341341e-05,
         -6.91420188e-05,  -5.29306792e-05,  -3.91770490e-05,
         -2.80589087e-05]],dtype = np.float64)

Gy = np.array([[  2.80589087e-05,   4.19754096e-05,   6.10738606e-05,
          8.64275235e-05,   1.18955637e-04,   1.59240764e-04,
          2.07328851e-04,   2.62543635e-04,   3.23354947e-04,
          3.87341287e-04,   4.51278182e-04,   5.11365174e-04,
          5.63578248e-04,   6.04106573e-04,   6.29809439e-04,
          6.38617820e-04,   6.29809439e-04,   6.04106573e-04,
          5.63578248e-04,   5.11365174e-04,   4.51278182e-04,
          3.87341287e-04,   3.23354947e-04,   2.62543635e-04,
          2.07328851e-04,   1.59240764e-04,   1.18955637e-04,
          8.64275235e-05,   6.10738606e-05,   4.19754096e-05,
          2.80589087e-05],
       [  3.91770490e-05,   5.86078630e-05,   8.52739375e-05,
          1.20673806e-04,   1.66090951e-04,   2.22338768e-04,
          2.89481413e-04,   3.66574656e-04,   4.51482013e-04,
          5.40822479e-04,   6.30093908e-04,   7.13989937e-04,
          7.86892064e-04,   8.43479446e-04,   8.79366886e-04,
          8.91665525e-04,   8.79366886e-04,   8.43479446e-04,
          7.86892064e-04,   7.13989937e-04,   6.30093908e-04,
          5.40822479e-04,   4.51482013e-04,   3.66574656e-04,
          2.89481413e-04,   2.22338768e-04,   1.66090951e-04,
          1.20673806e-04,   8.52739375e-05,   5.86078630e-05,
          3.91770490e-05],
       [  5.29306792e-05,   7.91829419e-05,   1.15210501e-04,
          1.63037970e-04,   2.24399414e-04,   3.00393785e-04,
          3.91107758e-04,   4.95265622e-04,   6.09980850e-04,
          7.30685488e-04,   8.51296853e-04,   9.64645712e-04,
          1.06314111e-03,   1.13959426e-03,   1.18808047e-03,
          1.20469671e-03,   1.18808047e-03,   1.13959426e-03,
          1.06314111e-03,   9.64645712e-04,   8.51296853e-04,
          7.30685488e-04,   6.09980850e-04,   4.95265622e-04,
          3.91107758e-04,   3.00393785e-04,   2.24399414e-04,
          1.63037970e-04,   1.15210501e-04,   7.91829419e-05,
          5.29306792e-05],
       [  6.91420188e-05,   1.03434691e-04,   1.50496588e-04,
          2.12972411e-04,   2.93127327e-04,   3.92396867e-04,
          5.10894256e-04,   6.46953061e-04,   7.96802686e-04,
          9.54476128e-04,   1.11202773e-03,   1.26009250e-03,
          1.38875457e-03,   1.48862340e-03,   1.55195972e-03,
          1.57366509e-03,   1.55195972e-03,   1.48862340e-03,
          1.38875457e-03,   1.26009250e-03,   1.11202773e-03,
          9.54476128e-04,   7.96802686e-04,   6.46953061e-04,
          5.10894256e-04,   3.92396867e-04,   2.93127327e-04,
          2.12972411e-04,   1.50496588e-04,   1.03434691e-04,
          6.91420188e-05],
       [  8.72341341e-05,   1.30500033e-04,   1.89876427e-04,
          2.68700050e-04,   3.69828781e-04,   4.95073785e-04,
          6.44577910e-04,   8.16238679e-04,   1.00529886e-03,
          1.20423008e-03,   1.40300757e-03,   1.58981586e-03,
          1.75214442e-03,   1.87814552e-03,   1.95805480e-03,
          1.98543974e-03,   1.95805480e-03,   1.87814552e-03,
          1.75214442e-03,   1.58981586e-03,   1.40300757e-03,
          1.20423008e-03,   1.00529886e-03,   8.16238679e-04,
          6.44577910e-04,   4.95073785e-04,   3.69828781e-04,
          2.68700050e-04,   1.89876427e-04,   1.30500033e-04,
          8.72341341e-05],
       [  1.06160509e-04,   1.58813406e-04,   2.31072142e-04,
          3.26997389e-04,   4.50067077e-04,   6.02485319e-04,
          7.84425958e-04,   9.93330361e-04,   1.22340916e-03,
          1.46550063e-03,   1.70740502e-03,   1.93474336e-03,
          2.13229083e-03,   2.28562921e-03,   2.38287566e-03,
          2.41620205e-03,   2.38287566e-03,   2.28562921e-03,
          2.13229083e-03,   1.93474336e-03,   1.70740502e-03,
          1.46550063e-03,   1.22340916e-03,   9.93330361e-04,
          7.84425958e-04,   6.02485319e-04,   4.50067077e-04,
          3.26997389e-04,   2.31072142e-04,   1.58813406e-04,
          1.06160509e-04],
       [  1.24397310e-04,   1.86095194e-04,   2.70766909e-04,
          3.83170692e-04,   5.27381927e-04,   7.05983362e-04,
          9.19178706e-04,   1.16396979e-03,   1.43357271e-03,
          1.71725190e-03,   2.00071188e-03,   2.26710358e-03,
          2.49858677e-03,   2.67826642e-03,   2.79221836e-03,
          2.83126974e-03,   2.79221836e-03,   2.67826642e-03,
          2.49858677e-03,   2.26710358e-03,   2.00071188e-03,
          1.71725190e-03,   1.43357271e-03,   1.16396979e-03,
          9.19178706e-04,   7.05983362e-04,   5.27381927e-04,
          3.83170692e-04,   2.70766909e-04,   1.86095194e-04,
          1.24397310e-04],
       [  1.40023272e-04,   2.09471232e-04,   3.04778844e-04,
          4.31302041e-04,   5.93628130e-04,   7.94664288e-04,
          1.03463981e-03,   1.31017992e-03,   1.61364856e-03,
          1.93296164e-03,   2.25202798e-03,   2.55188202e-03,
          2.81244260e-03,   3.01469240e-03,   3.14295823e-03,
          3.18691498e-03,   3.14295823e-03,   3.01469240e-03,
          2.81244260e-03,   2.55188202e-03,   2.25202798e-03,
          1.93296164e-03,   1.61364856e-03,   1.31017992e-03,
          1.03463981e-03,   7.94664288e-04,   5.93628130e-04,
          4.31302041e-04,   3.04778844e-04,   2.09471232e-04,
          1.40023272e-04],
       [  1.50898975e-04,   2.25741007e-04,   3.28451227e-04,
          4.64801567e-04,   6.39735635e-04,   8.56386410e-04,
          1.11500100e-03,   1.41194249e-03,   1.73898175e-03,
          2.08309610e-03,   2.42694454e-03,   2.75008845e-03,
          3.03088694e-03,   3.24884563e-03,   3.38707395e-03,
          3.43444485e-03,   3.38707395e-03,   3.24884563e-03,
          3.03088694e-03,   2.75008845e-03,   2.42694454e-03,
          2.08309610e-03,   1.73898175e-03,   1.41194249e-03,
          1.11500100e-03,   8.56386410e-04,   6.39735635e-04,
          4.64801567e-04,   3.28451227e-04,   2.25741007e-04,
          1.50898975e-04],
       [  1.54936515e-04,   2.31781062e-04,   3.37239456e-04,
          4.77238064e-04,   6.56852768e-04,   8.79300375e-04,
          1.14483460e-03,   1.44972123e-03,   1.78551094e-03,
          2.13883261e-03,   2.49188126e-03,   2.82367139e-03,
          3.11198309e-03,   3.33577360e-03,   3.47770045e-03,
          3.52633883e-03,   3.47770045e-03,   3.33577360e-03,
          3.11198309e-03,   2.82367139e-03,   2.49188126e-03,
          2.13883261e-03,   1.78551094e-03,   1.44972123e-03,
          1.14483460e-03,   8.79300375e-04,   6.56852768e-04,
          4.77238064e-04,   3.37239456e-04,   2.31781062e-04,
          1.54936515e-04],
       [  1.50426061e-04,   2.25033538e-04,   3.27421866e-04,
          4.63344887e-04,   6.37730715e-04,   8.53702510e-04,
          1.11150660e-03,   1.40751749e-03,   1.73353181e-03,
          2.07656772e-03,   2.41933854e-03,   2.74146972e-03,
          3.02138820e-03,   3.23866380e-03,   3.37645893e-03,
          3.42368136e-03,   3.37645893e-03,   3.23866380e-03,
          3.02138820e-03,   2.74146972e-03,   2.41933854e-03,
          2.07656772e-03,   1.73353181e-03,   1.40751749e-03,
          1.11150660e-03,   8.53702510e-04,   6.37730715e-04,
          4.63344887e-04,   3.27421866e-04,   2.25033538e-04,
          1.50426061e-04],
       [  1.36364046e-04,   2.03997125e-04,   2.96814065e-04,
          4.20030834e-04,   5.78114859e-04,   7.73897343e-04,
          1.00760159e-03,   1.27594101e-03,   1.57147911e-03,
          1.88244760e-03,   2.19317578e-03,   2.48519374e-03,
          2.73894509e-03,   2.93590950e-03,   3.06082337e-03,
          3.10363139e-03,   3.06082337e-03,   2.93590950e-03,
          2.73894509e-03,   2.48519374e-03,   2.19317578e-03,
          1.88244760e-03,   1.57147911e-03,   1.27594101e-03,
          1.00760159e-03,   7.73897343e-04,   5.78114859e-04,
          4.20030834e-04,   2.96814065e-04,   2.03997125e-04,
          1.36364046e-04],
       [  1.12715650e-04,   1.68619728e-04,   2.45340257e-04,
          3.47188643e-04,   4.77857569e-04,   6.39687248e-04,
          8.32862258e-04,   1.05466597e-03,   1.29895155e-03,
          1.55599155e-03,   1.81283292e-03,   2.05420882e-03,
          2.26395434e-03,   2.42676098e-03,   2.53001215e-03,
          2.56539636e-03,   2.53001215e-03,   2.42676098e-03,
          2.26395434e-03,   2.05420882e-03,   1.81283292e-03,
          1.55599155e-03,   1.29895155e-03,   1.05466597e-03,
          8.32862258e-04,   6.39687248e-04,   4.77857569e-04,
          3.47188643e-04,   2.45340257e-04,   1.68619728e-04,
          1.12715650e-04],
       [  8.05475431e-05,   1.20497064e-04,   1.75322193e-04,
          2.48103899e-04,   3.41481004e-04,   4.57125842e-04,
          5.95170315e-04,   7.53673100e-04,   9.28241608e-04,
          1.11192453e-03,   1.29546552e-03,   1.46795475e-03,
          1.61784065e-03,   1.73418363e-03,   1.80796778e-03,
          1.83325363e-03,   1.80796778e-03,   1.73418363e-03,
          1.61784065e-03,   1.46795475e-03,   1.29546552e-03,
          1.11192453e-03,   9.28241608e-04,   7.53673100e-04,
          5.95170315e-04,   4.57125842e-04,   3.41481004e-04,
          2.48103899e-04,   1.75322193e-04,   1.20497064e-04,
          8.05475431e-05],
       [  4.19872959e-05,   6.28119205e-05,   9.13908050e-05,
          1.29329976e-04,   1.78004982e-04,   2.38287566e-04,
          3.10246485e-04,   3.92869779e-04,   4.83867708e-04,
          5.79616741e-04,   6.75291785e-04,   7.65205842e-04,
          8.43337382e-04,   9.03983889e-04,   9.42445606e-04,
          9.55626450e-04,   9.42445606e-04,   9.03983889e-04,
          8.43337382e-04,   7.65205842e-04,   6.75291785e-04,
          5.79616741e-04,   4.83867708e-04,   3.92869779e-04,
          3.10246485e-04,   2.38287566e-04,   1.78004982e-04,
          1.29329976e-04,   9.13908050e-05,   6.28119205e-05,
          4.19872959e-05],
       [  0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00,   0.00000000e+00,   0.00000000e+00,
          0.00000000e+00],
       [ -4.19872959e-05,  -6.28119205e-05,  -9.13908050e-05,
         -1.29329976e-04,  -1.78004982e-04,  -2.38287566e-04,
         -3.10246485e-04,  -3.92869779e-04,  -4.83867708e-04,
         -5.79616741e-04,  -6.75291785e-04,  -7.65205842e-04,
         -8.43337382e-04,  -9.03983889e-04,  -9.42445606e-04,
         -9.55626450e-04,  -9.42445606e-04,  -9.03983889e-04,
         -8.43337382e-04,  -7.65205842e-04,  -6.75291785e-04,
         -5.79616741e-04,  -4.83867708e-04,  -3.92869779e-04,
         -3.10246485e-04,  -2.38287566e-04,  -1.78004982e-04,
         -1.29329976e-04,  -9.13908050e-05,  -6.28119205e-05,
         -4.19872959e-05],
       [ -8.05475431e-05,  -1.20497064e-04,  -1.75322193e-04,
         -2.48103899e-04,  -3.41481004e-04,  -4.57125842e-04,
         -5.95170315e-04,  -7.53673100e-04,  -9.28241608e-04,
         -1.11192453e-03,  -1.29546552e-03,  -1.46795475e-03,
         -1.61784065e-03,  -1.73418363e-03,  -1.80796778e-03,
         -1.83325363e-03,  -1.80796778e-03,  -1.73418363e-03,
         -1.61784065e-03,  -1.46795475e-03,  -1.29546552e-03,
         -1.11192453e-03,  -9.28241608e-04,  -7.53673100e-04,
         -5.95170315e-04,  -4.57125842e-04,  -3.41481004e-04,
         -2.48103899e-04,  -1.75322193e-04,  -1.20497064e-04,
         -8.05475431e-05],
       [ -1.12715650e-04,  -1.68619728e-04,  -2.45340257e-04,
         -3.47188643e-04,  -4.77857569e-04,  -6.39687248e-04,
         -8.32862258e-04,  -1.05466597e-03,  -1.29895155e-03,
         -1.55599155e-03,  -1.81283292e-03,  -2.05420882e-03,
         -2.26395434e-03,  -2.42676098e-03,  -2.53001215e-03,
         -2.56539636e-03,  -2.53001215e-03,  -2.42676098e-03,
         -2.26395434e-03,  -2.05420882e-03,  -1.81283292e-03,
         -1.55599155e-03,  -1.29895155e-03,  -1.05466597e-03,
         -8.32862258e-04,  -6.39687248e-04,  -4.77857569e-04,
         -3.47188643e-04,  -2.45340257e-04,  -1.68619728e-04,
         -1.12715650e-04],
       [ -1.36364046e-04,  -2.03997125e-04,  -2.96814065e-04,
         -4.20030834e-04,  -5.78114859e-04,  -7.73897343e-04,
         -1.00760159e-03,  -1.27594101e-03,  -1.57147911e-03,
         -1.88244760e-03,  -2.19317578e-03,  -2.48519374e-03,
         -2.73894509e-03,  -2.93590950e-03,  -3.06082337e-03,
         -3.10363139e-03,  -3.06082337e-03,  -2.93590950e-03,
         -2.73894509e-03,  -2.48519374e-03,  -2.19317578e-03,
         -1.88244760e-03,  -1.57147911e-03,  -1.27594101e-03,
         -1.00760159e-03,  -7.73897343e-04,  -5.78114859e-04,
         -4.20030834e-04,  -2.96814065e-04,  -2.03997125e-04,
         -1.36364046e-04],
       [ -1.50426061e-04,  -2.25033538e-04,  -3.27421866e-04,
         -4.63344887e-04,  -6.37730715e-04,  -8.53702510e-04,
         -1.11150660e-03,  -1.40751749e-03,  -1.73353181e-03,
         -2.07656772e-03,  -2.41933854e-03,  -2.74146972e-03,
         -3.02138820e-03,  -3.23866380e-03,  -3.37645893e-03,
         -3.42368136e-03,  -3.37645893e-03,  -3.23866380e-03,
         -3.02138820e-03,  -2.74146972e-03,  -2.41933854e-03,
         -2.07656772e-03,  -1.73353181e-03,  -1.40751749e-03,
         -1.11150660e-03,  -8.53702510e-04,  -6.37730715e-04,
         -4.63344887e-04,  -3.27421866e-04,  -2.25033538e-04,
         -1.50426061e-04],
       [ -1.54936515e-04,  -2.31781062e-04,  -3.37239456e-04,
         -4.77238064e-04,  -6.56852768e-04,  -8.79300375e-04,
         -1.14483460e-03,  -1.44972123e-03,  -1.78551094e-03,
         -2.13883261e-03,  -2.49188126e-03,  -2.82367139e-03,
         -3.11198309e-03,  -3.33577360e-03,  -3.47770045e-03,
         -3.52633883e-03,  -3.47770045e-03,  -3.33577360e-03,
         -3.11198309e-03,  -2.82367139e-03,  -2.49188126e-03,
         -2.13883261e-03,  -1.78551094e-03,  -1.44972123e-03,
         -1.14483460e-03,  -8.79300375e-04,  -6.56852768e-04,
         -4.77238064e-04,  -3.37239456e-04,  -2.31781062e-04,
         -1.54936515e-04],
       [ -1.50898975e-04,  -2.25741007e-04,  -3.28451227e-04,
         -4.64801567e-04,  -6.39735635e-04,  -8.56386410e-04,
         -1.11500100e-03,  -1.41194249e-03,  -1.73898175e-03,
         -2.08309610e-03,  -2.42694454e-03,  -2.75008845e-03,
         -3.03088694e-03,  -3.24884563e-03,  -3.38707395e-03,
         -3.43444485e-03,  -3.38707395e-03,  -3.24884563e-03,
         -3.03088694e-03,  -2.75008845e-03,  -2.42694454e-03,
         -2.08309610e-03,  -1.73898175e-03,  -1.41194249e-03,
         -1.11500100e-03,  -8.56386410e-04,  -6.39735635e-04,
         -4.64801567e-04,  -3.28451227e-04,  -2.25741007e-04,
         -1.50898975e-04],
       [ -1.40023272e-04,  -2.09471232e-04,  -3.04778844e-04,
         -4.31302041e-04,  -5.93628130e-04,  -7.94664288e-04,
         -1.03463981e-03,  -1.31017992e-03,  -1.61364856e-03,
         -1.93296164e-03,  -2.25202798e-03,  -2.55188202e-03,
         -2.81244260e-03,  -3.01469240e-03,  -3.14295823e-03,
         -3.18691498e-03,  -3.14295823e-03,  -3.01469240e-03,
         -2.81244260e-03,  -2.55188202e-03,  -2.25202798e-03,
         -1.93296164e-03,  -1.61364856e-03,  -1.31017992e-03,
         -1.03463981e-03,  -7.94664288e-04,  -5.93628130e-04,
         -4.31302041e-04,  -3.04778844e-04,  -2.09471232e-04,
         -1.40023272e-04],
       [ -1.24397310e-04,  -1.86095194e-04,  -2.70766909e-04,
         -3.83170692e-04,  -5.27381927e-04,  -7.05983362e-04,
         -9.19178706e-04,  -1.16396979e-03,  -1.43357271e-03,
         -1.71725190e-03,  -2.00071188e-03,  -2.26710358e-03,
         -2.49858677e-03,  -2.67826642e-03,  -2.79221836e-03,
         -2.83126974e-03,  -2.79221836e-03,  -2.67826642e-03,
         -2.49858677e-03,  -2.26710358e-03,  -2.00071188e-03,
         -1.71725190e-03,  -1.43357271e-03,  -1.16396979e-03,
         -9.19178706e-04,  -7.05983362e-04,  -5.27381927e-04,
         -3.83170692e-04,  -2.70766909e-04,  -1.86095194e-04,
         -1.24397310e-04],
       [ -1.06160509e-04,  -1.58813406e-04,  -2.31072142e-04,
         -3.26997389e-04,  -4.50067077e-04,  -6.02485319e-04,
         -7.84425958e-04,  -9.93330361e-04,  -1.22340916e-03,
         -1.46550063e-03,  -1.70740502e-03,  -1.93474336e-03,
         -2.13229083e-03,  -2.28562921e-03,  -2.38287566e-03,
         -2.41620205e-03,  -2.38287566e-03,  -2.28562921e-03,
         -2.13229083e-03,  -1.93474336e-03,  -1.70740502e-03,
         -1.46550063e-03,  -1.22340916e-03,  -9.93330361e-04,
         -7.84425958e-04,  -6.02485319e-04,  -4.50067077e-04,
         -3.26997389e-04,  -2.31072142e-04,  -1.58813406e-04,
         -1.06160509e-04],
       [ -8.72341341e-05,  -1.30500033e-04,  -1.89876427e-04,
         -2.68700050e-04,  -3.69828781e-04,  -4.95073785e-04,
         -6.44577910e-04,  -8.16238679e-04,  -1.00529886e-03,
         -1.20423008e-03,  -1.40300757e-03,  -1.58981586e-03,
         -1.75214442e-03,  -1.87814552e-03,  -1.95805480e-03,
         -1.98543974e-03,  -1.95805480e-03,  -1.87814552e-03,
         -1.75214442e-03,  -1.58981586e-03,  -1.40300757e-03,
         -1.20423008e-03,  -1.00529886e-03,  -8.16238679e-04,
         -6.44577910e-04,  -4.95073785e-04,  -3.69828781e-04,
         -2.68700050e-04,  -1.89876427e-04,  -1.30500033e-04,
         -8.72341341e-05],
       [ -6.91420188e-05,  -1.03434691e-04,  -1.50496588e-04,
         -2.12972411e-04,  -2.93127327e-04,  -3.92396867e-04,
         -5.10894256e-04,  -6.46953061e-04,  -7.96802686e-04,
         -9.54476128e-04,  -1.11202773e-03,  -1.26009250e-03,
         -1.38875457e-03,  -1.48862340e-03,  -1.55195972e-03,
         -1.57366509e-03,  -1.55195972e-03,  -1.48862340e-03,
         -1.38875457e-03,  -1.26009250e-03,  -1.11202773e-03,
         -9.54476128e-04,  -7.96802686e-04,  -6.46953061e-04,
         -5.10894256e-04,  -3.92396867e-04,  -2.93127327e-04,
         -2.12972411e-04,  -1.50496588e-04,  -1.03434691e-04,
         -6.91420188e-05],
       [ -5.29306792e-05,  -7.91829419e-05,  -1.15210501e-04,
         -1.63037970e-04,  -2.24399414e-04,  -3.00393785e-04,
         -3.91107758e-04,  -4.95265622e-04,  -6.09980850e-04,
         -7.30685488e-04,  -8.51296853e-04,  -9.64645712e-04,
         -1.06314111e-03,  -1.13959426e-03,  -1.18808047e-03,
         -1.20469671e-03,  -1.18808047e-03,  -1.13959426e-03,
         -1.06314111e-03,  -9.64645712e-04,  -8.51296853e-04,
         -7.30685488e-04,  -6.09980850e-04,  -4.95265622e-04,
         -3.91107758e-04,  -3.00393785e-04,  -2.24399414e-04,
         -1.63037970e-04,  -1.15210501e-04,  -7.91829419e-05,
         -5.29306792e-05],
       [ -3.91770490e-05,  -5.86078630e-05,  -8.52739375e-05,
         -1.20673806e-04,  -1.66090951e-04,  -2.22338768e-04,
         -2.89481413e-04,  -3.66574656e-04,  -4.51482013e-04,
         -5.40822479e-04,  -6.30093908e-04,  -7.13989937e-04,
         -7.86892064e-04,  -8.43479446e-04,  -8.79366886e-04,
         -8.91665525e-04,  -8.79366886e-04,  -8.43479446e-04,
         -7.86892064e-04,  -7.13989937e-04,  -6.30093908e-04,
         -5.40822479e-04,  -4.51482013e-04,  -3.66574656e-04,
         -2.89481413e-04,  -2.22338768e-04,  -1.66090951e-04,
         -1.20673806e-04,  -8.52739375e-05,  -5.86078630e-05,
         -3.91770490e-05],
       [ -2.80589087e-05,  -4.19754096e-05,  -6.10738606e-05,
         -8.64275235e-05,  -1.18955637e-04,  -1.59240764e-04,
         -2.07328851e-04,  -2.62543635e-04,  -3.23354947e-04,
         -3.87341287e-04,  -4.51278182e-04,  -5.11365174e-04,
         -5.63578248e-04,  -6.04106573e-04,  -6.29809439e-04,
         -6.38617820e-04,  -6.29809439e-04,  -6.04106573e-04,
         -5.63578248e-04,  -5.11365174e-04,  -4.51278182e-04,
         -3.87341287e-04,  -3.23354947e-04,  -2.62543635e-04,
         -2.07328851e-04,  -1.59240764e-04,  -1.18955637e-04,
         -8.64275235e-05,  -6.10738606e-05,  -4.19754096e-05,
         -2.80589087e-05]],dtype=np.float64)

def grae(Image):
    """
    Gradient energy
    :param Image:
    :return:
    """
    endy,endx = Image.shape
    Ix = np.copy(Image)
    Iy = np.copy(Image)
    Iy[0:endy-1,:] = np.diff(Image, 1, 0);
    Ix[:, 0:endx-1] = np.diff(Image, 1, 1);
    FM = Ix**2 + Iy**2
    FM = np.mean(FM)
    return FM

def gras(Image):
    Ix = np.diff(Image, 1, 0)
    FM = Ix**2
    FM = np.mean(FM)
    return FM

def lape(Image):
    LAP = spfilt.laplace(Image)
    LAP = LAP**2
    FM = np.mean(LAP)
    return FM

def sfreq(Image):
    endy, endx = Image.shape
    Ix = np.copy(Image)
    Iy = np.copy(Image)
    Iy[0:endy - 1, :] = np.diff(Image, 1, 0)
    Ix[:, 0:endx - 1] = np.diff(Image, 1, 1)
    FM = np.mean(np.sqrt(np.array((Iy** 2 + Ix**2)),dtype=np.float32));
    return FM

def glva(Image):
    """
    Grey level variance
    :param Image:
    :return:
    """
    return np.std(Image)

def vola(Image):
    Image = np.array(Image,dtype=np.float32)

    endy, endx = Image.shape
    I1 = np.copy(Image)
    I1[0:endy - 1,:] = Image[1:endy,:]
    I2 = np.copy(Image)
    I2[0:endy - 2,:] = Image[2:endy,:]
    Image = np.multiply(Image,(I1 - I2))
    FM = np.mean(Image)
    return FM


def gder(Image):

    delta = 0.0
    Rx = cv2.filter2D(Image, cv2.CV_64F, Gx,None,(0,0),delta,cv2.BORDER_REPLICATE)
    Ry = cv2.filter2D(Image, cv2.CV_64F, Gy,None,(0,0),delta,cv2.BORDER_REPLICATE)
    FM = Rx**2 + Ry**2
    FM = np.mean(FM)
    return FM

def blur(Image, d =3):
    """
    Maybe because imfilter is not properly translate the result is different
    :param Image:
    :return:
    """
    I= np.array(Image, dtype=np.float64)
    y,x = I.shape
    Hv= np.ones((9, 1), np.float32) / 9
    Hh = Hv.transpose()
    delta = 0.0

    B_Ver = cv2.filter2D(I,  cv2.CV_64F, Hv,None,(0,0),delta,cv2.BORDER_REPLICATE)  # blur input image vertically
    B_Hor = cv2.filter2D(I,  cv2.CV_64F, Hh,None,(0,0),delta,cv2.BORDER_REPLICATE) #  blur input horizontally


    D_F_Ver = np.abs(I[:, 0:x - d] - I[:, d:x])# variation vertical
    D_F_Hor = np.abs(I[0:y - d,:] - I[d:y,:])# variation horizontal

    D_B_Ver = np.abs(B_Ver[:, 0:x - d]-B_Ver[:, d:x]) # variation blurred vertical
    D_B_Hor = np.abs(B_Hor[0:y - d,:]-B_Hor[d:y,:]) # variation blurred horizontal


    T_Ver = D_F_Ver - D_B_Ver # difference of vertical variations
    T_Hor = D_F_Hor - D_B_Hor # difference of horizontal variations

    V_Ver = np.maximum(np.zeros(T_Ver.shape),T_Ver)
    V_Hor = np.maximum(np.zeros(T_Hor.shape),T_Hor)

    S_D_Ver = np.sum(D_F_Ver[1:y - d, 1:x - d])
    S_D_Hor = np.sum(D_F_Hor[1:y - d, 1:x - d])

    S_V_Ver = np.sum(V_Ver[1:y - d, 1:x - d])
    S_V_Hor = np.sum(V_Hor[1:y - d, 1:x - d])

    blur_F_Ver = (S_D_Ver - S_V_Ver) / S_D_Ver
    blur_F_Hor = (S_D_Hor - S_V_Hor) / S_D_Hor

    blur = np.max([blur_F_Ver, blur_F_Hor])
    return blur


def fmeasure( measure, image, x = 0,y = 0, w = 0,h = 0 ):

    if(x>0 and y>0):
        image = image[y:y + h, x:x + w]
        # NOTE: its img[y: y + h, x: x + w] and *not* img[x: x + w, y: y + h]
        #cv2.imshow("cropped", crop_img)
        #cv2.waitKey(0)
    if measure=='GRAE':
        return grae(image)
    elif measure=='GRAS':
        return gras(image)
    elif measure == 'LAPE':
        return lape(image)
    elif measure == 'SFREQ':
        return sfreq(image)
    elif measure == 'GLVA':
        return glva(image)
    elif measure == 'BLUR':
        return blur(image)
    elif measure == 'VOLA':
        return vola(image)
    elif measure == 'GDER':
        return gder(image)
    return 0



def is_slice_file(file):
    p = re.compile(r'.*um.*tif$')
    # if name has slice and um
    if(p.match(file)):
        return True
    return False


def hasQualityDrop(list_measures,start = 10, itail = 2, max_val = 30, threshold_drop = 0.15,verbose = False):
    if len(list_measures)<start:
        if verbose :
            print("File too small to determine drop.")
        return False
    mmax = np.max(list_measures)
    mmax= np.min((mmax,max_val))
    mg_diff = -np.diff(list_measures)/mmax
    mg_diff = mg_diff[::-1]
    for el in mg_diff[:itail]:
       if el>= threshold_drop :
           if verbose:
               float_formatter = lambda x: "%.2f" % x
               np.set_printoptions(formatter={'float_kind': float_formatter})
               print("Element found to have a drop bigger than "+str(threshold_drop*100)+" %:"+str(el))
           return True
    return False

# from imutils import blackBorderDetection
#odir= "PROJECT_NOV3_2I_field--X02--Y08_0025--001___0008\\"
# odir = "PROJECT_NOV3_3E_field--X00--Y00_0001___0013\\"
# odir = "PROJECT_NOV3_8E_field--X00--Y03_0003___0019\\"
# list_files = os.listdir(odir)
#
# list_measures = []
# for el in list_files:
#      if is_slice_file(odir+el):
#          im_crop,_ = blackBorderDetection(odir+el)
#          f1 = fmeasure('GDER', im_crop)
#          list_measures.append(f1)
#
# f2 = fmeasure('SFREQ',im_crop)